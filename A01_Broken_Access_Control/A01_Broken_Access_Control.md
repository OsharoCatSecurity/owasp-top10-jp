# A01 Broken Access Controlï¼ˆã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®ä¸å‚™ï¼‰

OWASP Top 10 ã§æœ€ã‚‚æ·±åˆ»ã¨ã•ã‚Œã‚‹è„†å¼±æ€§ã€‚  
ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãŒå£Šã‚Œã¦ã„ã‚‹ã¨ **æœ¬æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè§¦ã‚Œã¦ã—ã¾ã†ã€‚**

---

## 1. Broken Access Control ã¨ã¯

ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¨ã¯ã€Œãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ *ä½•ã‚’* ã—ã¦ã‚ˆã„ã‹ã€ã‚’æ±ºã‚ã‚‹ä»•çµ„ã¿ã€‚  
Broken Access Control ã§ã¯ã€ã“ã®åˆ¶å¾¡ãŒæ­£ã—ãåƒã‹ãªã„ã€‚

### ã‚ˆãã‚ã‚‹ä¾‹:
- URL ã‚’ç›´æ¥å©ãã¨ç®¡ç†ç”»é¢ã«å…¥ã‚Œã¦ã—ã¾ã†  
- ä»–äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æŒ‡å®šã™ã‚‹ã¨æƒ…å ±ãŒè¦‹ãˆã‚‹ï¼ˆIDORï¼‰  
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒœã‚¿ãƒ³éè¡¨ç¤ºã ã‘ã§åˆ¶å¾¡ã—ã¦ã„ã‚‹

---

## 2. å›³è§£ï¼ˆMermaidï¼‰

```
<div class="mermaid">
flowchart TD
  U[ãƒ¦ãƒ¼ã‚¶ãƒ¼] -->|ãƒªã‚¯ã‚¨ã‚¹ãƒˆ| APP[Webã‚¢ãƒ—ãƒª]
  APP -->|èªå¯ãƒã‚§ãƒƒã‚¯| AUTH{æ¨©é™ã¯æ­£ã—ã„ã‹?}
  AUTH -->|YES| OK[è¨±å¯ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹]
  AUTH -->|NO| DENY[ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦]

  subgraph BrokenAccess
    APP -->|ä¸ååˆ†ãªèªå¯| LEAK[æœ¬æ¥ç¦æ­¢ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹]
  end
</div>
```

---

## 3. ã‚ˆãã‚ã‚‹è„†å¼±æ€§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### â— URL ç›´æ‰“ã¡ã§ç®¡ç†ç”»é¢ã«å…¥ã‚Œã¦ã—ã¾ã†
```
/admin ã¸ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨èª°ã§ã‚‚å…¥ã‚Œã‚‹
```

### â— IDORï¼ˆInsecure Direct Object Referenceï¼‰
```
GET /user/1234 â†’ è‡ªåˆ†  
GET /user/1235 â†’ ä»–äººï¼ˆæœ¬æ¥ç¦æ­¢ï¼‰  
```

### â— ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã¿ã§åˆ¶å¾¡
- JavaScript ã§ãƒœã‚¿ãƒ³éè¡¨ç¤º  
- hidden ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¨©é™åˆ¤å®š  
â†’ ã©ã¡ã‚‰ã‚‚å®¹æ˜“ã«æ”¹ã–ã‚“ã•ã‚Œçªç ´ã•ã‚Œã‚‹

---

## 4. æ”»æ’ƒæ‰‹æ³•ã®ä¾‹

- æ¨©é™æ˜‡æ ¼ï¼ˆUser â†’ Adminï¼‰
- èªå¯ã‚’ã™ã‚ŠæŠœã‘ã¦ç®¡ç† API ã‚’æ“ä½œ
- ç›´æ¥ URL ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãæŠœã

---

## 5. é˜²æ­¢ç­–ï¼ˆå®Ÿå‹™å‘ã‘ï¼‰

- **ã‚µãƒ¼ãƒãƒ¼å´ã§å¿…ãšèªå¯ãƒã‚§ãƒƒã‚¯**
- **ID ã‚’æ¨æ¸¬ã§ããªã„å€¤ã«ã™ã‚‹ï¼ˆUUID ãªã©ï¼‰**
- **æ©Ÿèƒ½ã”ã¨ã«RBAC / ABAC ã‚’è¨­è¨ˆ**
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã¿ã§ã®åˆ¶å¾¡ã¯çµ¶å¯¾ã«NG**
- **ãƒ­ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã§ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œçŸ¥**

---

## 6. å‚è€ƒè³‡æ–™
- OWASP Top 10 (2021)  
- OWASP Cheat Sheet Series  
- NIST SP 800-63 / Access Control Guidance

---
### ğŸ”§ è„†å¼±ãªã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆNode.js / Expressï¼‰

```javascript
// âŒ IDãƒã‚§ãƒƒã‚¯ãªã— â†’ ä»–äººã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¦ã—ã¾ã†
app.get("/user/:id", (req, res) => {
  const data = db.getUser(req.params.id);
  res.json(data);
});
```

```
javascript
// âœ” ä¿®æ­£ç‰ˆï¼šèªå¯ãƒã‚§ãƒƒã‚¯ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿæ–½
app.get("/user/:id", (req, res) => {
  if (req.user.id !== req.params.id) {
    return res.status(403).send("Forbidden");
  }
  const data = db.getUser(req.user.id);
  res.json(data);
});
```<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ startOnLoad: true });
</script>
